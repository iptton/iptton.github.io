---
title: "用 Kiro 开发一个大型系统"
date: "2025-07-17"
---

软件工程的完整流程涉及多角色的协作，在多数 AI Coding Agent 中，这些角色要么就要人类来赋予 LLM 角色分饰多角，要么就是人类来担任编码以外的所有角色（需求分析，系统设计，任务拆解，验收测试）。聪明的朋友已经知道，这些角色其实 LLM 都非常胜任，你可以提一个非常模糊的需求让 LLM 细化并要求 LLM 反复修改直到你满意，但这有一个很大的问题，这些对话的产出你需要人工来维护（或通过某些 Coding tool 提供的 Rule 机制来完成），而 Kiro 的出现则原生地把这些流程固化下来了，这也许让人类完成一个复杂系统的开发的心智成本大大降低。（*其实之前也有些 agent 会这样做，比如 google 的 firebase studio, 腾讯 codebuddy，都很明显在 prompt 里做了类似的要求，但都没显性地把流程固化下来*）

我希望让 Kiro 帮我完成一个 mindmap 系统，支持多 native/desktop/web/mobile 同时提供 server，这是一个复杂的系统，Kiro 提供的流程是 Spec Driven Development，从它设计的 task 来看，应该是分解了不同 task，并关联不同的需求上下文，这将大大减少上下文长度，这也许能让大项目在 AI 上变得可行。

-----

## 需求分析，系统设计，任务拆解

初始 prompt，选用 Spec 模式

![[Pasted image 20250717204615.png]]

输入：

`这是一个 kotlin multiplatform 技术实现的 Desktop/Mobile/Web 跨平台 MindMap 应用`

Kiro 进行需求分析阶段，输出 `Requirement.md` ,我仔细看了下，发现它提到了跨平台共用，这和我预期的纯本地应用不一致，既然 AI 给自己加需求了，那就增加个难度吧：

`我说漏了一个平台，还需要支持 server 否则无法跨端同步，请添加 server 侧的需求，同样，也以 kmp 来完成`

Kiro 输出了这样一份需求：

![[Pasted image 20250717205015.png]]
![[Pasted image 20250717205033.png]]

看起来不错了，进入下一步吧。

Kiro 接下来输出一份设计文档，包含核心设计原则，整体架构图，模块结构，领域层/数据层/网络层 等的数据结构和 API ，UI 层的状态管理架构 (MVI)，数据库的 Schema (PostgreSQL/Sqlite/IndexedDb)，错误处理的数据结构，出错处理策略；测试策略：

```markdown
核心架构特点：

基于 Kotlin Multiplatform 的四平台支持（Desktop、Mobile、Web、Server）
采用现代化的分层架构（Domain、Data、Network、UI）
使用 Compose Multiplatform 实现 UI 层
服务端使用 Ktor + PostgreSQL
关键设计决策：

代码共享最大化：业务逻辑完全共享
离线优先：支持离线操作和自动同步
实时协作：WebSocket 实现多设备同步
MVI 架构：统一的状态管理模式
技术栈选择：

共享层：Kotlin Multiplatform + Ktor Client
UI 层：Compose Multiplatform
服务端：Ktor Server + PostgreSQL
本地存储：SQLite (移动端/桌面端) + IndexedDB (Web端)
```

看起来也很完整了，继续下一步，生成了 25 个开发任务（任务中还会有子任务），每个子任务对应1 到 5 个需求项

```markdown
计划特点：

渐进式开发：从核心数据模型开始，逐步构建各层功能
测试驱动：每个主要组件都包含相应的测试任务
平台并行：共享代码优先，然后并行开发各平台特定功能
实用优先：优先实现核心功能，后续添加优化和高级特性
关键里程碑：

任务 1-3：项目基础架构
任务 4-9：共享业务逻辑层
任务 10-12：服务端实现
任务 13-17：UI 层核心功能
任务 18-21：各平台应用实现
任务 22-25：优化、测试和部署
每个任务都明确引用了相关的需求，确保实现覆盖所有功能要求。
```


## 版本处理 hook

看起来不错了，不过根据之前用 Kiro 的经验，它并不会主动 commit ，需要添加一个 agent hook 让它完成。

左侧界面上添加一个 agent hook，它的创建方式也非常地 AI ，你只需要提供一个自然语言的描述，然后回车即可通过 AI 创建：

![[Pasted image 20250717210215.png]]

回车后，创建一个新会话

![[Pasted image 20250717210231.png]]

左侧显示创建出来的 hook

![[Pasted image 20250717210107.png]]

## 创建 Agent Steering

steer, 掌舵。

生成了三个文件，看起来是一份备忘录，用于指引跨会话时 LLM 保证不偏离方向。

仔细看了下 tech，发现它设计要求 web 侧使用 Browser-based UI，iOS 使用 SwiftUI，这和我设想的不一样，要求它修改：

```
技术部分，请完全使用 compose multiplatform，不要 SwiftUI，web 侧使用 wasm target
```

![[Pasted image 20250717210642.png]]

## MCP Servers

暂时先不考虑，未来如果考虑布署应该接入 cloudflare 等。

## 开工

只需在 tasklist 里不断点启动以及在输入框架中输入“继续”即可（经常出现系统繁忙中断）

![[Pasted image 20250717212913.png]]


