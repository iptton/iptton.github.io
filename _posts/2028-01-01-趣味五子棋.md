---
title: "趣味五子棋"
date: "2025-10-05"
---


# 项目需求：五子棋技能对战游戏（Flutter）  
  
## 一、核心功能概述  
开发一款基于 Flutter 的五子棋技能对战游戏，无需用户登录，支持单人对战 AI，融合传统五子棋规则与角色技能系统。  
  
## 二、角色选择系统  
  
### 2.1 可选角色  
- **张呈**  
- **技能五**  
- **子棋**  
  
### 2.2 角色展示要求  
- **选择界面**：展示角色 9:16 竖版形象（全身像）  
- **对局界面**：展示角色 1:1 头像（头部特写）  
- 每个角色需要两套图片资源：  
- `{角色名}_portrait_9_16.png`（选择界面用）  
- `{角色名}_avatar_1_1.png`（对局界面用）  
  
### 2.3 对战分配规则  
- 用户选择 1 个角色  
- 系统从剩余 2 个角色中**随机选择 1 个**作为 AI 对手  
- 黑白棋分配：**随机决定**用户执黑或执白  
  
## 三、技能系统设计  
  
### 3.1 技能列表及效果  
  
| 技能名称          | 游戏内效果                   | 使用条件限制                | 对外展示描述                |     |
| ------------- | ----------------------- | --------------------- | --------------------- | --- |
| **飞沙走石**      | 随机移除对手棋盘上 1 枚棋子         | 对手棋盘上至少有 1 枚棋子        | "把对手棋盘上的一颗棋子直接扔进什刹海"  |     |
| **拾金不昧**      | 反制"飞沙走石"，被移除的棋子回到原位     | 仅当对手使用"飞沙走石"时可用       | "击飞扔来的棋子，回到原来位置"      |     |
| **棒球呀累呀累**    | 反制"飞沙走石"，被移除的棋子回到原位     | 仅当对手使用"飞沙走石"时可用       | "击飞扔来的棋子，回到原来位置"      |     |
| **擒拿**        | 反制"飞沙走石"，阻止移除，棋子保持原位    | 仅当对手使用"飞沙走石"时可用       | "阻止扔棋子，棋子回到原来位置"      |     |
| **静如止水**      | 对手本回合及下一回合无法行动（跳过 2 回合） | 无                     | "对手本回合与下一回合都无法行动"     |     |
| **水滴石穿**      | 反制"静如止水"，解除冻结状态         | 仅当对手使用"静如止水"时可用       | "解除，继续行动"             |     |
| **东山再起**      | 反制"力拔山兮"，阻止对手直接获胜       | 仅当对手使用"力拔山兮"时可用       | "捡起棋盘,对局继续"           |     |
| **调呈离山**      | 对手本回合及下一回合无法行动（跳过 2 回合） | 仅当对手角色是"张呈"时可用        | "把对手挪走，本回合与下一回合都无法行动" |     |
| **滚！**        | 纯展示效果，无实际游戏影响           | 无                     | "呵斥对手一下"              |     |
| **你骂老人**      | 反制"滚！"，纯展示效果            | 仅当对手使用"滚！"时可用         | "道德施压"                |     |
| **保洁上门**      | 随机移除对手棋盘上 1 枚棋子         | 对手棋盘上至少有 1 枚棋子        | "随机扫走对手的一颗棋子"         |     |
| **你这个畜生**     | 纯展示效果，无实际游戏影响           | 无                     | "呵斥对手一下"              |     |
| **你这辈子别跟我说话** | 纯展示效果，无实际游戏影响           | 无                     | "呵斥对手一下"              |     |
| **力拔山兮**      | 直接获胜（一击必杀技能）            | 无                     | "摔坏棋盘，直接获胜"           |     |
| **两极反转**      | 反制"力拔山兮"，阻止对手直接获胜       | 仅当对手是"张呈"且使用"力拔山兮"时可用 | "放出张呈羞耻照片"            |     |
  
### 3.2 角色技能配置  
  
**张呈的技能池：**  
- 飞沙走石  
- 拾金不昧  
- 擒拿  
- 静如止水  
- 力拔山兮  
- 东山再起  
- 滚！  
- 你这辈子别跟我说话  
  
**技能五的技能池：**  
- 飞沙走石  
- 拾金不昧  
- 棒球呀累呀累  
- 力拔山兮  
- 调呈离山  
- 你骂老人  
- 保洁上门  
- 你这个畜生  
- 两极反转  
  
**子棋的技能池：**  
- 飞沙走石  
- 拾金不昧  
- 静如止水  
- 水滴石穿  
- 力拔山兮  
- 调呈离山  
- 两极反转  
  
### 3.3 技能使用规则  
- 每回合玩家可选择：**正常落子** 或 **使用 1 个技能**  
- 使用技能时需在界面上展示技能名称和描述  
- 技能使用后需有明显的视觉反馈（动画/提示）  
- 反制类技能仅在触发条件满足时才可选择  
  
## 四、AI 策略设计要求  
  
### 4.1 设计目标  
- **优先级 1**：趣味性和随机性（而非最优策略）  
- **优先级 2**：游戏体验的平衡性  
- **优先级 3**：适度的挑战性  
  
### 4.2 AI 行为规则  
1. **一击必杀技能（力拔山兮）使用概率**：  
- 基础概率：5-10%（每回合）  
- 当 AI 处于劣势时，概率提升至 15-20%  
- 当 AI 处于优势时，概率降低至 2-5%  
  
2. **普通技能使用策略**：  
- 30% 概率随机使用可用技能  
- 70% 概率正常落子  
- 反制技能在触发条件满足时有 60-80% 概率使用  
  
3. **落子策略**：  
- 40% 概率选择最优位置（防守/进攻）  
- 40% 概率选择次优位置  
- 20% 概率随机落子  
  
4. **技能选择权重**：  
- 纯展示技能（滚！、你这个畜生等）：10% 权重  
- 控制类技能（静如止水、调呈离山）：30% 权重  
- 破坏类技能（飞沙走石、保洁上门）：40% 权重  
- 一击必杀技能（力拔山兮）：独立概率计算  
  
## 五、资源文件要求  
  
### 5.1 资源目录结构  
```  
assets/  
├── images/  
│ ├── characters/  
│ │ ├── zhangcheng_portrait_9_16.png  
│ │ ├── zhangcheng_avatar_1_1.png  
│ │ ├── jinengwu_portrait_9_16.png  
│ │ ├── jinengwu_avatar_1_1.png  
│ │ ├── ziqi_portrait_9_16.png  
│ │ └── ziqi_avatar_1_1.png  
│ └── skills/  
│ └── (技能图标，如需要)  
└── audio/  
├── bgm/  
│ └── victory.mp3 (或 .ogg)  
└── sfx/  
└── (技能音效，如需要)  
```  
  
### 5.2 pubspec.yaml 配置  
- 自动扫描 `assets/` 目录下的所有资源文件  
- 更新 `pubspec.yaml` 的 `assets` 配置段  
  
## 六、技术栈要求  
  
### 6.1 状态管理  
- **必须使用**：`flutter_bloc`  
- 建议 Bloc 结构：  
- `CharacterSelectionBloc`（角色选择）  
- `GameBloc`（游戏主逻辑）  
- `SkillBloc`（技能系统）  
- `AIBloc`（AI 决策）  
  
### 6.2 其他依赖建议  
- 音频播放：`audioplayers` 或 `just_audio`  
- 动画效果：Flutter 内置 `AnimationController`  
  
## 七、UI/UX 要求  
  
### 7.1 角色选择界面  
- 横向滑动或网格展示 3 个角色  
- 点击角色后高亮显示  
- 显示"开始游戏"按钮  
  
### 7.2 对局界面  
- 15×15 标准五子棋棋盘  
- 顶部显示双方头像（1:1）  
- 显示当前回合指示  
- 技能按钮区域（展示可用技能列表）  
- 技能使用时弹出技能描述卡片  
  
### 7.3 结算界面  
- 播放胜利背景音乐  
- 显示胜利方角色形象  
- 提供"再来一局"和"返回选择"按钮  
  
## 八、开发要求  
  
### 8.1 TDD 开发流程  
1. 先为核心业务逻辑编写测试用例：  
- 五子棋胜负判定逻辑  
- 技能效果执行逻辑  
- AI 决策逻辑  
- 技能使用条件验证  
  
2. 按 Red-Green-Refactor 循环开发：  
- 🔴 RED: 编写失败测试 → `git commit -m "RED: 添加测试 - [测试描述]"`  
- 🟢 GREEN: 实现功能使测试通过 → `git commit -m "GREEN: 实现功能 - [功能描述]"`  
- 🔵 REFACTOR: 重构优化 → `git commit -m "REFACTOR: 优化代码 - [重构内容]"`  
  
3. 每个功能完成后更新 `.augment/features.md`  
  
### 8.2 代码质量要求  
- 使用依赖注入提高可测试性  
- 核心逻辑与 UI 分离  
- 每个测试方法只验证一个行为  
- 测试覆盖边界条件和异常情况  
  
## 九、实现优先级建议  
  
### Phase 1: 基础框架  
1. 项目结构搭建（Bloc 架构）  
2. 资源文件整理和 pubspec.yaml 配置  
3. 角色数据模型定义  
  
### Phase 2: 核心游戏逻辑  
1. 五子棋棋盘逻辑（落子、胜负判定）  
2. 回合管理系统  
3. 基础 AI（仅落子，无技能）  
  
### Phase 3: 技能系统  
1. 技能数据模型和配置  
2. 技能效果执行引擎  
3. 技能使用条件验证  
4. 反制技能链处理  
  
### Phase 4: AI 增强  
1. AI 技能决策系统  
2. 随机性和趣味性调优  
3. 一击必杀技能概率控制  
  
### Phase 5: UI 实现  
1. 角色选择界面  
2. 对局界面（棋盘 + 技能按钮）  
3. 技能展示动画  
4. 结算界面  
  
### Phase 6: 音效和优化  
1. 背景音乐和音效集成  
2. 性能优化  
3. 整体测试和调优  
  
## 十、特别注意事项  
  
1. **技能克制关系**需要明确的状态机管理（如"飞沙走石"触发时，对手可选择反制技能）  
2. **一击必杀技能**的概率需要可配置，便于后期平衡性调整  
3. **AI 随机性**要确保不会出现"太傻"或"太强"的极端情况  
4. **技能动画**建议使用简单的缩放/淡入淡出效果，避免过度复杂  
5. **资源文件命名**需要规范统一，便于代码中引用  
  
<IMPORTANT>**请尽可能地自动测试而非让人类来验证，在完全完成任务前，不要停下来询问是否继续！！！！</IMPORTANT># 项目需求：五子棋技能对战游戏（Flutter）  
  
## 一、核心功能概述  
开发一款基于 Flutter 的五子棋技能对战游戏，无需用户登录，支持单人对战 AI，融合传统五子棋规则与角色技能系统。  
  
## 二、角色选择系统  
  
### 2.1 可选角色  
- **张呈**  
- **技能五**  
- **子棋**  
  
### 2.2 角色展示要求  
- **选择界面**：展示角色 9:16 竖版形象（全身像）  
- **对局界面**：展示角色 1:1 头像（头部特写）  
- 每个角色需要两套图片资源：  
- `{角色名}_portrait_9_16.png`（选择界面用）  
- `{角色名}_avatar_1_1.png`（对局界面用）  
  
### 2.3 对战分配规则  
- 用户选择 1 个角色  
- 系统从剩余 2 个角色中**随机选择 1 个**作为 AI 对手  
- 黑白棋分配：**随机决定**用户执黑或执白  
  
## 三、技能系统设计  
  
### 3.1 技能列表及效果  
  
| 技能名称          | 游戏内效果                   | 使用条件限制                | 对外展示描述                |     |
| ------------- | ----------------------- | --------------------- | --------------------- | --- |
| **飞沙走石**      | 随机移除对手棋盘上 1 枚棋子         | 对手棋盘上至少有 1 枚棋子        | "把对手棋盘上的一颗棋子直接扔进什刹海"  |     |
| **拾金不昧**      | 反制"飞沙走石"，被移除的棋子回到原位     | 仅当对手使用"飞沙走石"时可用       | "击飞扔来的棋子，回到原来位置"      |     |
| **棒球呀累呀累**    | 反制"飞沙走石"，被移除的棋子回到原位     | 仅当对手使用"飞沙走石"时可用       | "击飞扔来的棋子，回到原来位置"      |     |
| **擒拿**        | 反制"飞沙走石"，阻止移除，棋子保持原位    | 仅当对手使用"飞沙走石"时可用       | "阻止扔棋子，棋子回到原来位置"      |     |
| **静如止水**      | 对手本回合及下一回合无法行动（跳过 2 回合） | 无                     | "对手本回合与下一回合都无法行动"     |     |
| **水滴石穿**      | 反制"静如止水"，解除冻结状态         | 仅当对手使用"静如止水"时可用       | "解除，继续行动"             |     |
| **东山再起**      | 反制"力拔山兮"，阻止对手直接获胜       | 仅当对手使用"力拔山兮"时可用       | "捡起棋盘,对局继续"           |     |
| **调呈离山**      | 对手本回合及下一回合无法行动（跳过 2 回合） | 仅当对手角色是"张呈"时可用        | "把对手挪走，本回合与下一回合都无法行动" |     |
| **滚！**        | 纯展示效果，无实际游戏影响           | 无                     | "呵斥对手一下"              |     |
| **你骂老人**      | 反制"滚！"，纯展示效果            | 仅当对手使用"滚！"时可用         | "道德施压"                |     |
| **保洁上门**      | 随机移除对手棋盘上 1 枚棋子         | 对手棋盘上至少有 1 枚棋子        | "随机扫走对手的一颗棋子"         |     |
| **你这个畜生**     | 纯展示效果，无实际游戏影响           | 无                     | "呵斥对手一下"              |     |
| **你这辈子别跟我说话** | 纯展示效果，无实际游戏影响           | 无                     | "呵斥对手一下"              |     |
| **力拔山兮**      | 直接获胜（一击必杀技能）            | 无                     | "摔坏棋盘，直接获胜"           |     |
| **两极反转**      | 反制"力拔山兮"，阻止对手直接获胜       | 仅当对手是"张呈"且使用"力拔山兮"时可用 | "放出张呈羞耻照片"            |     |
  
### 3.2 角色技能配置  
  
**张呈的技能池：**  
- 飞沙走石  
- 拾金不昧  
- 擒拿  
- 静如止水  
- 力拔山兮  
- 东山再起  
- 滚！  
- 你这辈子别跟我说话  
  
**技能五的技能池：**  
- 飞沙走石  
- 拾金不昧  
- 棒球呀累呀累  
- 力拔山兮  
- 调呈离山  
- 你骂老人  
- 保洁上门  
- 你这个畜生  
- 两极反转  
  
**子棋的技能池：**  
- 飞沙走石  
- 拾金不昧  
- 静如止水  
- 水滴石穿  
- 力拔山兮  
- 调呈离山  
- 两极反转  
  
### 3.3 技能使用规则  
- 每回合玩家可选择：**正常落子** 或 **使用 1 个技能**  
- 使用技能时需在界面上展示技能名称和描述  
- 技能使用后需有明显的视觉反馈（动画/提示）  
- 反制类技能仅在触发条件满足时才可选择  
  
## 四、AI 策略设计要求  
  
### 4.1 设计目标  
- **优先级 1**：趣味性和随机性（而非最优策略）  
- **优先级 2**：游戏体验的平衡性  
- **优先级 3**：适度的挑战性  
  
### 4.2 AI 行为规则  
1. **一击必杀技能（力拔山兮）使用概率**：  
- 基础概率：5-10%（每回合）  
- 当 AI 处于劣势时，概率提升至 15-20%  
- 当 AI 处于优势时，概率降低至 2-5%  
  
2. **普通技能使用策略**：  
- 30% 概率随机使用可用技能  
- 70% 概率正常落子  
- 反制技能在触发条件满足时有 60-80% 概率使用  
  
3. **落子策略**：  
- 40% 概率选择最优位置（防守/进攻）  
- 40% 概率选择次优位置  
- 20% 概率随机落子  
  
4. **技能选择权重**：  
- 纯展示技能（滚！、你这个畜生等）：10% 权重  
- 控制类技能（静如止水、调呈离山）：30% 权重  
- 破坏类技能（飞沙走石、保洁上门）：40% 权重  
- 一击必杀技能（力拔山兮）：独立概率计算  
  
## 五、资源文件要求  
  
### 5.1 资源目录结构  
```  
assets/  
├── images/  
│ ├── characters/  
│ │ ├── zhangcheng_portrait_9_16.png  
│ │ ├── zhangcheng_avatar_1_1.png  
│ │ ├── jinengwu_portrait_9_16.png  
│ │ ├── jinengwu_avatar_1_1.png  
│ │ ├── ziqi_portrait_9_16.png  
│ │ └── ziqi_avatar_1_1.png  
│ └── skills/  
│ └── (技能图标，如需要)  
└── audio/  
├── bgm/  
│ └── victory.mp3 (或 .ogg)  
└── sfx/  
└── (技能音效，如需要)  
```  
  
### 5.2 pubspec.yaml 配置  
- 自动扫描 `assets/` 目录下的所有资源文件  
- 更新 `pubspec.yaml` 的 `assets` 配置段  
  
## 六、技术栈要求  
  
### 6.1 状态管理  
- **必须使用**：`flutter_bloc`  
- 建议 Bloc 结构：  
- `CharacterSelectionBloc`（角色选择）  
- `GameBloc`（游戏主逻辑）  
- `SkillBloc`（技能系统）  
- `AIBloc`（AI 决策）  
  
### 6.2 其他依赖建议  
- 音频播放：`audioplayers` 或 `just_audio`  
- 动画效果：Flutter 内置 `AnimationController`  
  
## 七、UI/UX 要求  
  
### 7.1 角色选择界面  
- 横向滑动或网格展示 3 个角色  
- 点击角色后高亮显示  
- 显示"开始游戏"按钮  
  
### 7.2 对局界面  
- 15×15 标准五子棋棋盘  
- 顶部显示双方头像（1:1）  
- 显示当前回合指示  
- 技能按钮区域（展示可用技能列表）  
- 技能使用时弹出技能描述卡片  
  
### 7.3 结算界面  
- 播放胜利背景音乐  
- 显示胜利方角色形象  
- 提供"再来一局"和"返回选择"按钮  
  
## 八、开发要求  
  
### 8.1 TDD 开发流程  
1. 先为核心业务逻辑编写测试用例：  
- 五子棋胜负判定逻辑  
- 技能效果执行逻辑  
- AI 决策逻辑  
- 技能使用条件验证  
  
2. 按 Red-Green-Refactor 循环开发：  
- 🔴 RED: 编写失败测试 → `git commit -m "RED: 添加测试 - [测试描述]"`  
- 🟢 GREEN: 实现功能使测试通过 → `git commit -m "GREEN: 实现功能 - [功能描述]"`  
- 🔵 REFACTOR: 重构优化 → `git commit -m "REFACTOR: 优化代码 - [重构内容]"`  
  
3. 每个功能完成后更新 `.augment/features.md`  
  
### 8.2 代码质量要求  
- 使用依赖注入提高可测试性  
- 核心逻辑与 UI 分离  
- 每个测试方法只验证一个行为  
- 测试覆盖边界条件和异常情况  
  
## 九、实现优先级建议  
  
### Phase 1: 基础框架  
1. 项目结构搭建（Bloc 架构）  
2. 资源文件整理和 pubspec.yaml 配置  
3. 角色数据模型定义  
  
### Phase 2: 核心游戏逻辑  
1. 五子棋棋盘逻辑（落子、胜负判定）  
2. 回合管理系统  
3. 基础 AI（仅落子，无技能）  
  
### Phase 3: 技能系统  
1. 技能数据模型和配置  
2. 技能效果执行引擎  
3. 技能使用条件验证  
4. 反制技能链处理  
  
### Phase 4: AI 增强  
1. AI 技能决策系统  
2. 随机性和趣味性调优  
3. 一击必杀技能概率控制  
  
### Phase 5: UI 实现  
1. 角色选择界面  
2. 对局界面（棋盘 + 技能按钮）  
3. 技能展示动画  
4. 结算界面  
  
### Phase 6: 音效和优化  
1. 背景音乐和音效集成  
2. 性能优化  
3. 整体测试和调优  
  
## 十、特别注意事项  
  
1. **技能克制关系**需要明确的状态机管理（如"飞沙走石"触发时，对手可选择反制技能）  
2. **一击必杀技能**的概率需要可配置，便于后期平衡性调整  
3. **AI 随机性**要确保不会出现"太傻"或"太强"的极端情况  
4. **技能动画**建议使用简单的缩放/淡入淡出效果，避免过度复杂  
5. **资源文件命名**需要规范统一，便于代码中引用  
  
<IMPORTANT>请尽可能地自动测试而非让人类来验证，在完全完成任务前，不要停下来询问是否继续！！！！</IMPORTANT>


-----

```
1. 点击棋盘时出错了，日志如下：  
  
When the exception was thrown, this was the stack:  
#0 Provider._inheritedElementOf (package:provider/src/provider.dart:377:7)  
#1 Provider.of (package:provider/src/provider.dart:327:30)  
#2 ReadContext.read (package:provider/src/provider.dart:683:21)  
#3 _GameViewState._showRestartDialog.<anonymous closure>.<anonymous  
closure> (package:banggoflutter/screens/game_screen.dart:266:23)  
#4 _InkResponseState.handleTap  
(package:flutter/src/material/ink_well.dart:1171:21)  
  
2. 技能没法完事显示，请对手机屏幕考虑应该如何放置  
3. 人vs人你没实现，也没放入口  
4. 棋盘的黑点应该在交叉处（和围棋一样）  
5. 你是不是忘了我说的自动化？？？后面用 chrome 来测试吧，记得要自动化
```

----
我发现了以下5个问题需要修复，请按照TDD方法逐个解决：  
  
## 问题1：点击棋盘时出现Provider错误  
**错误描述**：点击棋盘时应用崩溃，错误堆栈显示Provider找不到上下文  
**错误日志**：  
```  
When the exception was thrown, this was the stack:  
#0 Provider._inheritedElementOf (package:provider/src/provider.dart:377:7)  
#1 Provider.of (package:provider/src/provider.dart:327:30)  
#2 ReadContext.read (package:provider/src/provider.dart:683:21)  
#3 _GameViewState._showRestartDialog.<anonymous closure>.<anonymous closure> (package:banggoflutter/screens/game_screen.dart:266:23)  
#4 _InkResponseState.handleTap (package:flutter/src/material/ink_well.dart:1171:21)  
```  
**问题位置**：`lib/screens/game_screen.dart` 第266行  
**需要修复**：检查GameScreen中的Provider使用，确保在正确的上下文中调用`context.read()`  
  
## 问题2：技能面板在手机屏幕上显示不完整  
**问题描述**：技能按钮无法完整显示在手机屏幕上  
**需要优化**：  
- 考虑手机屏幕的实际尺寸（特别是小屏手机）  
- 技能面板应该使用可滚动布局或更紧凑的排列方式  
- 建议使用ListView、GridView或Wrap组件来适配不同屏幕  
- 确保在不同屏幕尺寸下都能看到所有5个技能按钮  
  
## 问题3：缺少人vs人对战模式  
**问题描述**：当前只实现了人vs AI模式，没有实现人vs人对战功能  
**需要实现**：  
- 在角色选择界面添加游戏模式选择（人vs AI / 人vs人）  
- 人vs人模式下，两个玩家都可以选择角色  
- 人vs人模式下，不需要AI决策逻辑  
- 添加对应的测试用例  
  
## 问题4：棋盘黑点位置错误  
**问题描述**：五子棋的棋子应该放在交叉点上（像围棋一样），而不是格子中心  
**需要修复**：  
- 修改棋盘绘制逻辑，确保棋子放置在线的交叉点  
- 调整点击检测逻辑，使其对应交叉点位置  
- 更新相关测试用例  
  
## 问题5：缺少自动化测试  
**问题描述**：你忘记了我要求的自动化测试要求  
**需要实现**：  
- 使用Chrome浏览器进行Web端自动化测试  
- 创建端到端(E2E)自动化测试脚本  
- 测试应该能够自动运行，无需人工干预  
- 测试场景应包括：  
- 角色选择流程  
- 完整对局流程（落子、技能使用、胜负判定）  
- 人vs人和人vs AI两种模式  
- UI交互和响应  
- 建议使用`flutter_driver`或`integration_test`包进行Web端自动化测试  
  
**重要提醒**：  
- 按照TDD方法，先写测试再修复问题  
- 每个问题修复后都要运行完整测试套件确保没有破坏现有功能  
- 遵循Red-Green-Refactor流程并提交Git  
- 所有修复完成前不要停下来询问是否继续